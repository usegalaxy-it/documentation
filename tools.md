# How to install and update tools on Usegalaxy.it
- [How to install and update tools on Usegalaxy.it](#how-to-install-and-update-tools-on-usegalaxyit)
  - [Repo](#repo)
  - [Requirements](#requirements)
  - [Description](#description)
    - [Makefile](#makefile)
    - [Targets](#targets)
  - [Usage](#usage)
  - [New Tools](#new-tools)
  - [Set a Specific Version of Tool](#set-a-specific-version-of-tool)
  - [Reports](#reports)
  - [See also](#see-also)
  - [Author Information](#author-information)

## Repo

[usegalaxy-it-tools](https://github.com/usegalaxy-it/usegalaxy-it-tools) repository contains scripts to install tools from usegalaxy-eu-tools repository



## usegalaxy-eu-tools

### Update the sub module

### Requirements

- python >=3.8

Pip packages are desribed in `requirements.txt` file: 
- bioblend
- ephemeris
- pykwalify==1.7.0
- PyYAML>=4.2b1 

Install them by running:
```bash
pip install -r requirements.txt
```

### Description

#### Makefile
The Makefile defines several implicit rules that operate on specific file extensions. These implicit rules allow the Makefile to generate new file names by appending suffixes and then trigger corresponding actions on these generated files.  
The Makefile assumes the existence of YAML files containing tool definitions, as well as associated lock files (may be generated).

#### Targets
| Target         | Description                                                                                                                                                                                                                                                     |
| -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| help           | Displays a summary of available Makefile targets and their descriptions.                                                                                                                                                                                        |
| lint           | Lints the YAML files by performing validation checks and identifying any potential issues in the tool definitions.                                                                                                                                              |
| fix            | Attempts to fix any issues found in the YAML files, such as missing hashes, missing lock files, or other inconsistencies. Creates iles with suffix `*.yaml.lock`.                                                                                               |
| install        | Opreates on files with suffix `*.yaml.lock`. Installs the Galaxy tools specified in the YAML files on a Galaxy server. The installation process relies on the Galaxy API key and Galaxy address specified as `GALAXY_API_KEY` and `GALAXY_SERVER` respectively. |
| update_trusted | Runs the update script on specific YAML files, updating the tools specified in those files (list of tools is defined in the `Makefile` in `update_trusted` section).                                                                                            |
| update_all     | Updates all tools in the specified YAML files. It relies on the `scripts/update-tool.py` script.                                                                                                                                                                |


### Usage

Create lockfiles with versions and install tools:
```bash
make fix 
make install GALAXY_SERVER_URL=<http://...> GALAXY_API_KEY=<...>
```
Setup

- `*.yaml` files are manually curated  
- `*.yaml.lock` files are generated by `make fix`  
- tools are updated automatically every night by Jenkins jobs

### New Tools

New tools may be added by changing `*.yaml` files or creating a new one. 

### Set a Specific Version of Tool

Edit the `.yaml.lock` file to add the latest/specific changeset revision for the tool. 

Run:
```bash
make install
```

### Reports

Logs contain the information about installed/updated tools and their revisions. `report.log` is generated in the working directory by default.  
Nice looking report in Markdown is generated by running
```bash
cat report.log | python scripts/generate-report.py >
<path/to/file.md>
```
If necessary, reports can be stored in a separate repository, [usegalaxy.it-tools-reorts](https://github.com/usegalaxy-it/usegalaxy.it-tools-reorts) in this case. This is managed by Jenkins.   

### See also
- [CI/CD and Jenkins in Usegalaxy.it](https://github.com/usegalaxy-it/documentation/blob/main/jenkins.md)
 
## Author Information

[Marco Tangaro](https://github.com/mtangaro/)

[Polina Khmelevskaia](https://github.com/po-khmel)

